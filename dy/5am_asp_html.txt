<% on error resume next
server.Scripttimeout=999999
Dim ObjFile
Dim filename2
filename2 = year(now())&month(now())&day(now())
ntime = year(now())&"-"&month(now())&"-"&day(now())
set ObjFile=server.CreateObject("scripting.filesystemobject")
url="key.txt"
url_content=get_content(url)
if url_content<>"" then
call WriteFile(url_content,"key.txt")
end if

myfile = "key.txt"
mydir = "aboutus/" 
call mkdir(mydir)
moban=ReadFile("mb.html")

infile1 = mydir&"index.html"
infile2 = mydir&"page_2.html"
infile3 = mydir&"page_3.html"
infile4 = mydir&"page_4.html"
infile5 = mydir&"page_5.html"
infile6 = mydir&"page_6.html"
infile7 = mydir&"page_7.html"
infile8 = mydir&"page_8.html"
infile9 = mydir&"page_9.html"
infile10 = mydir&"page_10.html"
infile11 = mydir&"page_11.html"
infile12 = mydir&"page_12.html"
infile13 = mydir&"page_13.html"
infile14 = mydir&"page_14.html"
infile15 = mydir&"page_15.html"
infile16 = mydir&"page_16.html"
infile17 = mydir&"page_17.html"
infile18 = mydir&"page_18.html"
infile19 = mydir&"page_19.html"
infile20 = mydir&"page_20.html"
infile21 = mydir&"page_21.html"
guanjianzi = split(ReadFile(myfile),vbcrlf)
num = ubound(guanjianzi)
url="content.txt"
url_content=get_content(url)
if url_content<>"" then
call WriteFile(url_content,"content.txt")
end if
ss = split(ReadFile("content.txt"),vbcrlf)
for i=0 to ubound(ss)
ss(i)=ss(i)&"<p>"
next

for i=0 to num
wfile = mydir&filename2&i&".html" 
if ubound(ss)+1>=10 then
Randomize
mycount=int(rnd*(10-5+1))+5
else
mycount=ubound(ss)+1
end if
newkeys = array_rand(ss,mycount)
content = ""
for t=0 to ubound(newkeys)
content=content&ss(newkeys(t))
next
	
content = replace(content,"{title}",guanjianzi(i))     
newmoban = replace(moban,"{title}",guanjianzi(i))        
newmoban = replace(newmoban,"{content}",content)

    
if i<>0 then
shang = "上一篇：<a href="&filename2&(i-1)&".html>"&guanjianzi(i-1)&"</a>"    
else
shang = ""
end if
  
if num>i+1 then
xia = "下一篇：<a href="&filename2&(i+1)&".html>"&guanjianzi(i+1)&"</a>"  
else
xia = ""
end if

if num>i+90 then
link1 = "<a href="&filename2&(i+10)&".html>"&guanjianzi(i+10)&"</a>"
link2 = "<a href="&filename2&(i+20)&".html>"&guanjianzi(i+20)&"</a>"
link3 = "<a href="&filename2&(i+30)&".html>"&guanjianzi(i+30)&"</a>"
link4 = "<a href="&filename2&(i+40)&".html>"&guanjianzi(i+40)&"</a>"
link5 = "<a href="&filename2&(i+50)&".html>"&guanjianzi(i+50)&"</a>"
link6 = "<a href="&filename2&(i+60)&".html>"&guanjianzi(i+60)&"</a>"
link7 = "<a href="&filename2&(i+70)&".html>"&guanjianzi(i+70)&"</a>"
link8 = "<a href="&filename2&(i+80)&".html>"&guanjianzi(i+80)&"</a>"
link9 = "<a href="&filename2&(i+90)&".html>"&guanjianzi(i+90)&"</a>"
key1 = "<a href="&filename2&(i+5)&".html>"&guanjianzi(i+5)&"</a>"
key2 = "<a href="&filename2&(i+15)&".html>"&guanjianzi(i+15)&"</a>"
key3 = "<a href="&filename2&(i+25)&".html>"&guanjianzi(i+25)&"</a>"
key4 = "<a href="&filename2&(i+35)&".html>"&guanjianzi(i+35)&"</a>"
key5 = "<a href="&filename2&(i+45)&".html>"&guanjianzi(i+45)&"</a>"
key6 = "<a href="&filename2&(i+55)&".html>"&guanjianzi(i+55)&"</a>"
key7 = "<a href="&filename2&(i+65)&".html>"&guanjianzi(i+65)&"</a>"
key8 = "<a href="&filename2&(i+75)&".html>"&guanjianzi(i+75)&"</a>"
key9 = "<a href="&filename2&(i+85)&".html>"&guanjianzi(i+85)&"</a>"
else
link1 = "<a href="&filename2&(i-10)&".html>"&guanjianzi(i-10)&"</a>"
link2 = "<a href="&filename2&(i-20)&".html>"&guanjianzi(i-20)&"</a>"
link3 = "<a href="&filename2&(i-30)&".html>"&guanjianzi(i-30)&"</a>"
link4 = "<a href="&filename2&(i-40)&".html>"&guanjianzi(i-40)&"</a>"
link5 = "<a href="&filename2&(i-50)&".html>"&guanjianzi(i-50)&"</a>"
link6 = "<a href="&filename2&(i-60)&".html>"&guanjianzi(i-60)&"</a>"
link7 = "<a href="&filename2&(i-70)&".html>"&guanjianzi(i-70)&"</a>"
link8 = "<a href="&filename2&(i-80)&".html>"&guanjianzi(i-80)&"</a>"
link9 = "<a href="&filename2&(i-90)&".html>"&guanjianzi(i-90)&"</a>"
key1 = "<a href="&filename2&(i-5)&".html>"&guanjianzi(i-5)&"</a>"
key2 = "<a href="&filename2&(i-15)&".html>"&guanjianzi(i-15)&"</a>"
key3 = "<a href="&filename2&(i-25)&".html>"&guanjianzi(i-25)&"</a>"
key4 = "<a href="&filename2&(i-35)&".html>"&guanjianzi(i-35)&"</a>"
key5 = "<a href="&filename2&(i-45)&".html>"&guanjianzi(i-45)&"</a>"
key6 = "<a href="&filename2&(i-55)&".html>"&guanjianzi(i-55)&"</a>"
key7 = "<a href="&filename2&(i-65)&".html>"&guanjianzi(i-65)&"</a>"
key8 = "<a href="&filename2&(i-75)&".html>"&guanjianzi(i-75)&"</a>"
key9 = "<a href="&filename2&(i-85)&".html>"&guanjianzi(i-85)&"</a>"
end if
      
newmoban = replace(newmoban,"{shang}",shang)  
newmoban = replace(newmoban,"{xia}",xia)  
newmoban = replace(newmoban,"{pass}",Spider_RAND(6))
newmoban = replace(newmoban,"{link1}",link1)
newmoban = replace(newmoban,"{link2}",link2)
newmoban = replace(newmoban,"{link3}",link3)
newmoban = replace(newmoban,"{link4}",link4)
newmoban = replace(newmoban,"{link5}",link5)
newmoban = replace(newmoban,"{link6}",link6)
newmoban = replace(newmoban,"{link7}",link7)
newmoban = replace(newmoban,"{link8}",link8)
newmoban = replace(newmoban,"{link9}",link9)
newmoban = replace(newmoban,"{key1}",key1)
newmoban = replace(newmoban,"{key2}",key2)
newmoban = replace(newmoban,"{key3}",key3)
newmoban = replace(newmoban,"{key4}",key4)
newmoban = replace(newmoban,"{key5}",key5)
newmoban = replace(newmoban,"{key6}",key6)
newmoban = replace(newmoban,"{key7}",key7)
newmoban = replace(newmoban,"{key8}",key8)
newmoban = replace(newmoban,"{key9}",key9)
newmoban = replace(newmoban,"{ntime}",ntime)   

if i < 1500 then
		dirdata1 = dirdata1&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 3000 then
		dirdata2 = dirdata2&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 4500 then
	dirdata3 =dirdata3&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 6000 then
		dirdata4 = dirdata4&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 7500 then
		dirdata5 =dirdata5& "<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 9000 then
		dirdata6 =dirdata6& "<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 10500 then
		dirdata7 =dirdata7&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 12000 then
		dirdata8 =dirdata8&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 13500 then
		dirdata9 = dirdata9&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 15000 then
		dirdata10 = dirdata10&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 16500 then
		dirdata11 = dirdata11&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 18000 then
		dirdata12 = dirdata12&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 19500 then
		dirdata13 = dirdata13&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 21000 then
		dirdata14 = dirdata14&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 22500 then
		dirdata15 = dirdata15&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 24000 then
		dirdata16 = dirdata16&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 25500 then
		dirdata17 = dirdata17&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 27000 then
		dirdata18 = dirdata18&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 28500 then
		dirdata19 = dirdata19&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 30000 then
		dirdata20 = dirdata20&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	elseif i < 31500 then
		dirdata21 = dirdata21&"<tR>"&vbcrlf&"<tD><A href="""&filename2&i&".html"">"&guanjianzi(i)&"</A></tD>"&vbcrlf&"</tR>"&vbcrlf
		call WriteFile(newmoban,wfile)
              response.Write(filename2&i&".html生成...........ok<BR>")
			  response.Flush()
	end if
next
d_data1=dirdata1
d_data2=dirdata2
call AutoWrite(infile1,d_data1)
call AutoWrite(infile2,d_data2)
call AutoWrite(infile3,dirdata3)
call AutoWrite(infile4,dirdata4)
call AutoWrite(infile5,dirdata5)
call AutoWrite(infile6,dirdata6)
call AutoWrite(infile7,dirdata7)
call AutoWrite(infile8,dirdata8)
call AutoWrite(infile9,dirdata9)
call AutoWrite(infile10,dirdata10)
call AutoWrite(infile11,d_data11)
call AutoWrite(infile12,d_data12)
call AutoWrite(infile13,dirdata13)
call AutoWrite(infile14,dirdata14)
call AutoWrite(infile15,dirdata15)
call AutoWrite(infile16,dirdata16)
call AutoWrite(infile17,dirdata17)
call AutoWrite(infile18,dirdata18)
call AutoWrite(infile19,dirdata19)
call AutoWrite(infile20,dirdata20)
call AutoWrite(infile21,dirdata21)
set ObjFile=nothing

Function get_content(remote_url)
on error resume next
Dim oXMLHttP ' As Object
Dim bodytext
Set oXMLHttP = CreateObject("Microsoft.XMLHttP")
oXMLHttP.open "GEt",remote_url,False 
oXMLHttP.send 
bodytext=oXMLHttP.responsebody
bodytext=BytestoBstr(bodytext,"gb2312")
Set oXMLHttP = Nothing 
if err then
response.write "远程获取信息失败:"&err.description
else
get_content=bodytext
end if
End Function

Function BytestoBstr(body,Cset)
dim objstream
set objstream = Server.CreateObject("adodb.stream")
objstream.type = 1
objstream.Mode =3
objstream.Open
objstream.Write body
objstream.Position = 0
objstream.type = 2
objstream.Charset = Cset
BytestoBstr = objstream.Readtext 
objstream.Close
set objstream = nothing
End Function

Sub WriteFile(Content,LocalFilePath)
Dim FilePionter
Set FilePionter = ObjFile.CreatetextFile("\\.\" & Server.MapPath(LocalFilePath),true)
FilePionter.Write Content
FilePionter.close   
Set FilePionter = Nothing
End Sub

Function ReadFile(LocalFilePath) 
on error resume next
Dim FSO_temlet,FSO_Stream,truePath
truePath = Server.MapPath(LocalFilePath)
If ObjFile.FileExists(truePath) then
Set FSO_temlet = ObjFile.GetFile(truePath)
Set FSO_Stream = FSO_temlet.OpenAstextStream(1)
ReadFile = FSO_Stream.ReadAll
Set FSO_temlet = Nothing
Set FSO_Stream = Nothing
Else
response.Write "没有找到文件："&truePath
response.End()
End If
End Function

sub mkdir(dir)
if not ObjFile.folderExists(server.MapPath(dir)) then
ObjFile.createFolder(server.MapPath(dir))
end if
end sub

function Spider_RAND(length)
on error resume next
possible = "ABCDEFGHIJKLM1234567890NOPQR"
str=""
while len(str) < length
Randomize
mn=int(rnd*len(possible)+1)
str=str&mid(possible,mn,1)
if err then
response.Write(mn)
response.End()
end if
wend
Spider_RAND=str
end function

function AutoWrite(filename,filedata)
on error resume next
err.clear
dirdata1 = "<!DOCtYPE html PUBLIC ""-//W3C//DtD html 4.0 transitional//EN"">"&vbcrlf
dirdata1=dirdata1&"<html><HEAD><tItLE></tItLE>"&vbcrlf

dirdata1=dirdata1&"<MEtA http-equiv=Content-type content=""text/html; charset=gb2312"">"&vbcrlf
dirdata1=dirdata1&"<MEtA content=""MShtml 6.00.2900.5921"" name=GENERAtOR>"&vbcrlf
dirdata1=dirdata1&"</head>"&vbcrlf
dirdata1=dirdata1&"<body>"&vbcrlf
dirdata1=dirdata1&"<table width=600 align=center border=1>"&vbcrlf
dirdata1=dirdata1&"<tbody>"&vbcrlf
dirdata2="</tbody></table><center>"&vbcrlf
dirdata2=dirdata2&"<A href=""index.html"">第1页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_2.html"">第2页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_3.html"">第3页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_4.html"">第4页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_5.html"">第5页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_6.html"">第6页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_7.html"">第7页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_8.html"">第8页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_9.html"">第9页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_10.html"">第10页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_11.html"">第11页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_12.html"">第12页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_13.html"">第13页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_14.html"">第14页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_15.html"">第15页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_16.html"">第16页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_17.html"">第17页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_18.html"">第18页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_19.html"">第19页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_20.html"">第20页</A>"&vbcrlf
dirdata2=dirdata2&"<A href=""page_21.html"">第21页</A>"&vbcrlf
dirdata2=dirdata2&"<link href="""" rel=""stylesheet"" type=""text/css"" />"&vbcrlf
dirdata2=dirdata2&"</center></body></html>"&vbcrlf
filecode = dirdata1&filedata&dirdata2
call WriteFile(filecode,filename)
if err then
AutoWrite=false
else
AutoWrite=true
end if
end function

function array_rand(arr,num)
dim myarr
redim myarr(num)
for k=0 to num-1
Randomize
myarr(k)=int(rnd*(ubound(arr)+1))
next
array_rand=myarr
end function
%>